generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model Product {
  id          String   @id @default(cuid())
  name        String
  type        String
  price       Float
  minQty      Int
  maxQty      Int
  leadTime    Int
  description String   @db.Text
  tags        String[]

  customization String[]
  sizes         String[]
  colors        String[]

  stockQuebec   Int @default(0)
  stockMontreal Int @default(0)

  // Vector embedding pour RAG avec pgvector
  embedding Unsupported("vector(1024)")?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([price])
}

model ChatSession {
  id        String        @id @default(cuid())
  userId    String?
  createdAt DateTime      @default(now())
  messages  ChatMessage[]
}

model ChatMessage {
  id        String      @id @default(cuid())
  sessionId String
  session   ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  role    String
  content String @db.Text

  recommendedProducts String[]

  createdAt DateTime @default(now())

  @@index([sessionId])
}
